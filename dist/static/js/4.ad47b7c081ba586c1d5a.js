webpackJsonp([4],{SRlw:function(e,t,n){e.exports=n.p+"static/img/login.4c6cc21.jpg"},kvsw:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("mvHQ"),i=n.n(o),r=n("Xxa5"),a=n.n(r),s=n("exGp"),c=n.n(s),l=(n("lbHh"),n("woOf")),u=n.n(l),h=(n("xQ6c"),{data:function(){return{visible:!0,cv:{w:310,h:105},block:{l:42,L:63,r:9},randomPos:{x:0,y:0},canvasCtx:null,blockCtx:null,blockDom:null,sliderDom:null,sliderContainerDom:null,sliderMaskDom:null,el:null,img:null,trail:null}},watch:{},beforeCreate:function(){},created:function(){},beforeMount:function(){},mounted:function(){this.init()},methods:{close:function(){this.visible=!1},init:function(){this.canvasInit(),this.initImg(),this.bindEvents()},onRefresh:function(){this.reset()},onSuccess:function(){this.$emit("onSubmit")},onFail:function(){this.$message("验证错误，请再试一次！")},bindEvents:function(){var e=this;this.el.onselectstart=function(){return!1};var t=void 0,n=void 0,o=[],i=!1,r=function(e,t){e.classList.add(t)},a=function(e){t=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY,i=!0},s=function(a){if(!i)return!1;var s=a.clientX||a.touches[0].clientX,c=a.clientY||a.touches[0].clientY,l=s-t,u=c-n;if(l<0||l+38>=e.cv.w)return!1;e.sliderDom.style.left=l+"px";var h=(e.cv.w-40-20)/(e.cv.w-40)*l;e.blockDom.style.left=h+"px",r(e.sliderContainerDom,"sliderContainer_active"),e.sliderMaskDom.style.width=l+"px",o.push(u)},c=function(n){if(!i)return!1;var a,s;if(i=!1,(n.clientX||n.changedTouches[0].clientX)==t)return!1;a=e.sliderContainerDom,s="sliderContainer_active",a.classList.remove(s),e.trail=o;var c=e.verify(),l=c.spliced,u=c.verified;l?u?(r(e.sliderContainerDom,"sliderContainer_success"),e.onSuccess()):(r(e.sliderContainerDom,"sliderContainer_fail"),e.onFail(),e.reset()):(r(e.sliderContainerDom,"sliderContainer_fail"),e.onFail(),setTimeout(function(){e.reset()},1e3))};this.sliderDom.addEventListener("mousedown",a),this.sliderDom.addEventListener("touchstart",a),this.blockDom.addEventListener("mousedown",a),this.blockDom.addEventListener("touchstart",a),document.addEventListener("mousemove",s),document.addEventListener("touchmove",s),document.addEventListener("mouseup",c),document.addEventListener("touchend",c)},verify:function(){var e=function(e,t){return e+t},t=this.trail,n=t.reduce(e)/t.length,o=t.map(function(e){return e-n}),i=Math.sqrt(o.map(function(e){return e*e}).reduce(e)/t.length),r=parseInt(this.blockDom.style.left);return{spliced:Math.abs(r-this.randomPos.x)<10,verified:0!==i}},reset:function(){this.sliderContainerDom.className="sliderContainer",this.sliderDom.style.left=0,this.blockDom.style.left=0,this.sliderMaskDom.style.width=0,this.clean(),this.img.setSrc(this.getRandomImgSrc())},clean:function(){this.canvasCtx.clearRect(0,0,this.cv.w,this.cv.h),this.blockCtx.clearRect(0,0,this.cv.w,this.cv.h),this.blockDom.width=this.cv.w},draw:function(){this.randomPos.x=this.getRandomNumberByRange(this.block.L+10,this.cv.w-(this.block.L+10)),this.randomPos.y=this.getRandomNumberByRange(10+2*this.block.r,this.cv.h-(this.block.L+10)),this.drawBlock(this.canvasCtx,this.randomPos.x,this.randomPos.y,"fill"),this.drawBlock(this.blockCtx,this.randomPos.x,this.randomPos.y,"clip")},drawBlock:function(e,t,n,o){var i=this.block.r,r=this.block.l,a=Math.PI;e.beginPath(),e.moveTo(t,n),e.arc(t+r/2,n-i+2,i,.72*a,2.26*a),e.lineTo(t+r,n),e.arc(t+r+i-2,n+r/2,i,1.21*a,2.78*a),e.lineTo(t+r,n+r),e.lineTo(t,n+r),e.arc(t+i-2,n+r/2,i+.4,2.76*a,1.24*a,!0),e.lineTo(t,n),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e[o](),e.globalCompositeOperation="destination-over"},initImg:function(){var e=this,t=this.createImg(function(){e.draw(),e.canvasCtx.drawImage(t,0,0,e.cv.w,e.cv.h),e.blockCtx.drawImage(t,0,0,e.cv.w,e.cv.h);var n=e.randomPos.y-2*e.block.r-1,o=e.blockCtx.getImageData(e.randomPos.x-3,n,e.block.L,e.block.L);e.blockDom.width=e.block.L,e.blockCtx.putImageData(o,0,n)});this.img=t},canvasInit:function(){var e=this.createCanvas(this.cv.w,this.cv.h),t=e.cloneNode(!0);t.className="block";var n=this.el=document.getElementById("captcha");n.style.position="relative",n.style.width=this.cv.w+"px",u()(n.style,{position:"relative",width:this.cv.w+"px",margin:"0 auto"}),this.el=n,n.appendChild(e),n.appendChild(t),this.canvasCtx=e.getContext("2d"),this.blockCtx=t.getContext("2d"),this.blockDom=t,this.sliderDom=document.getElementsByClassName("slider")[0],this.sliderContainerDom=document.getElementsByClassName("sliderContainer")[0],this.sliderMaskDom=document.getElementsByClassName("sliderMask")[0]},createCanvas:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},createImg:function(e){var t=this,n=new Image;return n.crossOrigin="Anonymous",n.onload=e,n.onerror=function(){n.setSrc(t.getRandomImgSrc())},n.setSrc=function(e){if(window.navigator.userAgent.indexOf("Trident")>-1){var t=new XMLHttpRequest;t.onloadend=function(e){var t=new FileReader;t.readAsDataURL(e.target.response),t.onloadend=function(e){n.src=e.target.result}},t.open("GET",e),t.responseType="blob",t.send()}else n.src=e},n.setSrc(this.getRandomImgSrc()),n},getRandomNumberByRange:function(e,t){return Math.round(Math.random()*(t-e)+e)},getRandomImgSrc:function(){return"https://picsum.photos/300/150/?image="+this.getRandomNumberByRange(0,1084)}}}),d={render:function(){var e=this.$createElement,t=this._self._c||e;return this.visible?t("div",{staticClass:"mask_layer_model",staticStyle:{"z-index":"9"}},[this._m(0)]):this._e()},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"captcha_model"},[t("div",{staticClass:"content"},[t("div",{staticClass:"sliding-pictures"},[t("div",{attrs:{id:"captcha"}})])]),this._v(" "),t("div",{staticClass:"sliderContainer"},[t("div",{staticClass:"sliderMask"},[t("div",{staticClass:"slider"},[t("span",{staticClass:"sliderIcon"})])]),this._v(" "),t("span",{staticClass:"sliderText"},[this._v("向右滑动填充拼图")])])])}]},p={components:{slideCaptcha:n("VU/8")(h,d,!1,null,null,null).exports},created:function(){if(void 0!=this.getCookie()&&""!=this.getCookie()&&this.$router.push({path:"/",name:"",params:{}}),document.cookie.length>0)for(var e=document.cookie.split("; "),t=0;t<e.length;t++){var n=e[t].split("=");"username"==n[0]&&(this.form.name=n[1])}this.captcha=Math.floor(8999*Math.random()+1e3),console.log(this.captcha)},data:function(){return{captcha:"",loading:!1,phoneViewable:!1,disableFlag:!1,show:!1,router:"/",sign:1,checked:!1,phoneChecked:!1,picUrl:n("SRlw"),form:{name:"",pwd:""},phoneForm:{phone:"",captcha:"",sign:1},personnel:[{value:1,label:"员工"}],datas:[],rules:{name:[{required:!0,message:"用户名不能为空",trigger:"change"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"change"},{validator:function(e,t,n){/^\w+$/.test(t)?n():n(new Error("请输入字母、数字或者下划线"))},trigger:"change"}],pwd:[{required:!0,message:"密码不能为空",trigger:"change"},{min:4,max:16,message:"长度在 4 到 16 个字符",trigger:"change"}],phone:[{required:!0,message:"请输入电话",trigger:"blur"},{validator:function(e,t,n){/^(13[0-9]{9})|(15[0-9][0-9]{8})|(18[0-9][0-9]{8})$/.test(t)?n():n(new Error("电话号码不合法"))},trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"}]}}},methods:{handleClick:function(){this.$refs.child.onRefresh()},login:function(){""!=this.form.name&&null!=this.form.name&&""!=this.form.pwd&&null!=this.form.pwd?(this.show=!0,this.$refs.child.onRefresh()):alert("请填写账号和密码!")},close:function(){this.show=!1},gotoForgetPass:function(){this.$router.push({path:"/forgetPass",name:"forgetPass"})},sendCaptcha:function(e){var t=this;return c()(a.a.mark(function n(){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$http.post("/gateway/shiro/sendCaptcha",e);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,t)}))()},send:function(){var e=this;if(""!=this.phoneForm.phone&&null!=this.phoneForm.phone){/^(13[0-9]{9})|(15[0-9][0-9]{8})|(18[0-9][0-9]{8})$/.test(this.phoneForm.phone)?this.sendCaptcha({head:{version:"1",businessType:"12",equipId:"1",equipType:1,encrypt:1},body:{data:{phone:this.phoneForm.phone}}}).then(function(t){"success"==t.head.responseCode?(e.captcha=t.body.data,e.disableFlag=!0,e.dataRefreh(),console.log(e.captcha)):e.$message.error(t.head.message)}):alert("请输入正确格式的手机号!")}else alert("请输入手机号!")},dataRefreh:function(){var e=this;null==this.intervalId&&(this.intervalId=setTimeout(function(){e.captcha="",e.disableFlag=!1},3e5))},phoneDoLogin:function(e){var t=this;return c()(a.a.mark(function n(){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$http.post("/gateway/shiro/phoneDoLogin",e);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,t)}))()},phoneOnSubmit:function(e){var t,n=this;this.$refs[e].validate((t=c()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}alert("数据未填"),e.next=10;break;case 4:if(console.log(n.phoneForm),1==n.phoneChecked?localStorage.setItem("phoneNumber",i()(n.phoneForm.phone)):(new Date,localStorage.setItem("phoneNumber",i()(""))),n.captcha==n.phoneForm.captcha){e.next=9;break}return alert("验证码错误!"),e.abrupt("return");case 9:n.phoneDoLogin({head:{version:"1",businessType:"12",equipId:"1",equipType:1,encrypt:1},body:{data:{phone:n.phoneForm.phone,sign:n.phoneForm.sign}}}).then(function(e){if("success"==e.head.responseCode){alert("登录成功!");var t=new Date;t.setTime(t.getTime()+864e5);var o=1==n.phoneForm.sign?"staffToken":"examineeToken";window.document.cookie=o+"= "+e.body.data+";expires="+t.toGMTString(),n.$router.push({path:"/",name:"",params:{}})}else alert(e.head.message)});case 10:case"end":return e.stop()}},e,n)})),function(e){return t.apply(this,arguments)}))},phoneLogin:function(){this.phoneViewable=!0,this.phoneForm={phone:"",captcha:"",sign:1};var e=JSON.parse(localStorage.getItem("phoneNumber"));null!=e&&""!=e&&(this.phoneForm.phone=e)},getCookie:function(){if(document.cookie.length>0)for(var e=document.cookie.split("; "),t=0;t<e.length;t++){var n=e[t].split("=");if("staffToken"==n[0])return n[1]}},doLogin:function(e){var t=this;return c()(a.a.mark(function n(){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$http.post("/gateway/shiro/doLogin",e);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,t)}))()},onSubmit:function(e){var t=this;return c()(a.a.mark(function e(){var n,o,i,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return 1==t.checked?((n=new Date).setTime(n.getTime()+864e5),window.document.cookie="username = "+t.form.name+";expires="+n.toGMTString()):((n=new Date).setTime(n.getTime()+-1),window.document.cookie="username = ;expires="+n.toGMTString()),o={head:{version:"1",businessType:"12",equipId:"1",equipType:1,encrypt:1},body:{data:{sign:t.sign,username:t.form.name,password:t.form.pwd}}},e.next=4,t.doLogin(o);case 4:"success"==(i=e.sent).head.responseCode?(console.log("go"),alert("登录成功!"),(n=new Date).setTime(n.getTime()+864e5),r=1==t.sign?"staffToken":"examineeToken",window.document.cookie=r+"= "+i.body.data+";expires="+n.toGMTString(),t.$store.commit("setToken",i.body.data),t.$router.push({path:"/",name:"",params:{}}),t.doAddUserOnlineInfo()):(alert(i.head.message),t.show=!1);case 6:case"end":return e.stop()}},e,t)}))()},toRegister:function(){this.$router.push({name:"Register"})},doAddUserOnlineInfo:function(){this.$ajax.post("gateway/systemModule/doAddUserOnlineInfo",{head:{version:"1",token:this.getCookie(),businessType:"12",equipId:"1",equipType:1,encrypt:1},body:{data:{}}}).then(function(e){console.log("response.data.head.message="+e.data.head.message)},function(){console.log("error")})}}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"login"},[n("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"box-card",attrs:{"body-style":{padding:"0px"}}},[n("el-image",{staticClass:"img",attrs:{src:e.picUrl}}),e._v(" "),n("div",{staticClass:"login-box"},[n("h1",[e._v("登录")]),e._v(" "),n("el-form",{ref:"form",attrs:{model:e.form}},[n("el-form-item",{attrs:{prop:"name"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login("form")}}},[n("el-input",{attrs:{name:"name",autocomplete:"on",autofocus:"autofocus",type:"text",placeholder:"用户名"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),n("el-form-item",{attrs:{prop:"pwd"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login("form")}}},[n("el-input",{attrs:{name:"pwd",type:"password","show-password":"",placeholder:"密码"},model:{value:e.form.pwd,callback:function(t){e.$set(e.form,"pwd",t)},expression:"form.pwd"}})],1),e._v(" "),n("el-form-item",[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.sign,callback:function(t){e.sign=t},expression:"sign"}},e._l(e.personnel,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.login()}}},[e._v("登录")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.phoneLogin()}}},[e._v("手机号登录")]),e._v(" "),n("el-checkbox",{staticStyle:{zoom:"145%","margin-top":"5px"},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[n("label",[e._v("记住账号")])])],1),e._v(" "),n("br"),n("br"),e._v(" "),n("div",{staticStyle:{float:"right","margin-left":"20px"}},[n("a",{attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.gotoForgetPass()}}},[n("font",{staticStyle:{"font-size":"20px"},attrs:{color:"#409EFF"}},[e._v("忘记密码")])],1)]),e._v(" "),n("el-dialog",{staticStyle:{"margin-top":"6%","margin-left":"30%",height:"100%",width:"50%"},attrs:{title:"验证",visible:e.show},on:{"update:visible":function(t){e.show=t}}},[n("div",{staticStyle:{float:"right","margin-top":"-70px","margin-right":"28px"}},[n("el-button",{attrs:{type:"primary",round:""},on:{click:function(t){return e.handleClick()}}},[e._v("刷新图片")])],1),e._v(" "),n("transition",{attrs:{name:"fade"}},[n("slideCaptcha",{ref:"child",on:{onSubmit:e.onSubmit,close:e.close}})],1)],1),e._v(" "),n("el-dialog",{staticStyle:{height:"150%"},attrs:{title:"手机号登录",visible:e.phoneViewable},on:{"update:visible":function(t){e.phoneViewable=t}}},[n("el-form",{ref:"phoneForm",attrs:{rules:e.rules,model:e.phoneForm,size:"big","label-width":"100px"}},[n("el-row",[n("el-form-item",{attrs:{prop:"phone"}},[n("el-input",{attrs:{name:"phone",autocomplete:"on",autofocus:"autofocus",type:"text",placeholder:"手机号"},model:{value:e.phoneForm.phone,callback:function(t){e.$set(e.phoneForm,"phone",t)},expression:"phoneForm.phone"}}),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:e.disableFlag},on:{click:function(t){return e.send()}}},[e._v("发送验证码")])],1),e._v(" "),n("el-form-item",{attrs:{prop:"captcha"}},[n("el-input",{attrs:{name:"captcha",type:"text",placeholder:"验证码"},model:{value:e.phoneForm.captcha,callback:function(t){e.$set(e.phoneForm,"captcha",t)},expression:"phoneForm.captcha"}})],1),e._v(" "),n("el-form-item",[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.phoneForm.sign,callback:function(t){e.$set(e.phoneForm,"sign",t)},expression:"phoneForm.sign"}},e._l(e.personnel,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),n("el-checkbox",{staticStyle:{"margin-left":"250px","margin-top":"5px",zoom:"140%"},model:{value:e.phoneChecked,callback:function(t){e.phoneChecked=t},expression:"phoneChecked"}},[n("label",[e._v("记住手机号")])]),e._v(" "),n("el-button",{on:{click:function(t){e.phoneViewable=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.phoneOnSubmit("phoneForm")}}},[e._v("登录")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var f=n("VU/8")(p,m,!1,function(e){n("uK5I")},"data-v-4e664b04",null);t.default=f.exports},lbHh:function(e,t,n){var o,i;
/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */!function(r){if(void 0===(i="function"==typeof(o=r)?o.call(t,n,t,e):o)||(e.exports=i),!0,e.exports=r(),!!0){var a=window.Cookies,s=window.Cookies=r();s.noConflict=function(){return window.Cookies=a,s}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(o){function i(){}function r(t,n,r){if("undefined"!=typeof document){"number"==typeof(r=e({path:"/"},i.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var a=JSON.stringify(n);/^[\{\[]/.test(a)&&(n=a)}catch(e){}n=o.write?o.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in r)r[c]&&(s+="; "+c,!0!==r[c]&&(s+="="+r[c].split(";")[0]));return document.cookie=t+"="+n+s}}function a(e,n){if("undefined"!=typeof document){for(var i={},r=document.cookie?document.cookie.split("; "):[],a=0;a<r.length;a++){var s=r[a].split("="),c=s.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(s[0]);if(c=(o.read||o)(c,l)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(i[l]=c,e===l)break}catch(e){}}return e?i[e]:i}}return i.set=r,i.get=function(e){return a(e,!1)},i.getJSON=function(e){return a(e,!0)},i.remove=function(t,n){r(t,"",e(n,{expires:-1}))},i.defaults={},i.withConverter=n,i}(function(){})})},uK5I:function(e,t){},xQ6c:function(e,t){}});